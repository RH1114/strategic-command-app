<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Strategic Command</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
:root {
  --fondo: #1e2228;
  --panel: #2b3138;
  --texto: #e6edf3;
  --borde-suave: #3a414a;
  --radio: 8px;
  --sombra: 0 6px 18px rgba(0, 0, 0, 0.45);
}

body {
  margin: 0;
  font-family: "Segoe UI", Tahoma, sans-serif;
  background: var(--fondo);
  color: var(--texto);
}

/* PANEL PRINCIPAL */
#panel {
  background: var(--panel);
  padding: 25px;
  border-radius: var(--radio);
  max-width: 700px;
  margin: 40px auto;
  box-shadow: var(--sombra);
  border: 1px solid var(--borde-suave);
}

/* Inputs */
input, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  margin-bottom: 15px;
  border-radius: var(--radio);
  border: 1px solid var(--borde-suave);
  background: #242a31;
  color: var(--texto);
}

/* Lista estrategias */
#listaEstrategias li {
  background: #242a31;
  padding: 15px;
  border-radius: var(--radio);
  margin-bottom: 15px;
  border: 1px solid var(--borde-suave);
  list-style: none;
}
/* BOTN BASE */
button {
  padding: 10px 16px;
  border-radius: 10px;
  border: 1px solid rgba(212, 175, 55, 0.4); /* dorado sutil MCOC */
  cursor: pointer;
  font-weight: 600;
  position: relative;
  overflow: hidden;
  transition: all 0.2s ease;
  box-shadow: 0 6px 14px rgba(0,0,0,0.45);
}

/* EFECTO LUZ SOLO ARRIBA */
button::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 45%;
  background: linear-gradient(
    rgba(255,255,255,0.25),
    rgba(255,255,255,0.05)
  );
  pointer-events: none;
}

/* VERDE CONFIRMAR */
#btnGuardar,
.btn-editar {
  background: linear-gradient(to bottom, #3dbd76, #1f5e3f);
  color: white;
}

/* ROJO ELIMINAR */
.btn-eliminar {
  background: linear-gradient(to bottom, #c54848, #6b2323);
  color: white;
}

/* HOVER */
button:hover {
  transform: translateY(-2px);
  box-shadow: 
    0 0 0 1px rgba(212,175,55,0.6),
    0 10px 20px rgba(0,0,0,0.5);
}

/* CLICK */
button:active {
  transform: translateY(1px);
}
#listaEstrategias li {
  display: flex;
  flex-direction: column;   /* texto arriba */
  gap: 12px;                /* espacio entre texto y botones */
}

.contenido-estrategia {
  width: 100%;
}

.acciones-estrategia {
  display: flex;
  justify-content: flex-end; /* botones a la derecha */
  gap: 8px;
}
    /* ===== SISTEMA DE JERARQUA ===== */

/* Bot贸n principal */
.btn-principal {
  padding: 12px 22px;
  font-size: 15px;
}

/* Botones secundarios */
.btn-secundario {
  padding: 7px 14px;
  font-size: 13px;
}
  </style>
</head>
<body>

<h1>Strategic Command</h1>

<div id="login">
  <input type="email" id="email" placeholder="Correo">
  <input type="password" id="password" placeholder="Contrase帽a">
  <button onclick="login()">Iniciar sesi贸n</button>
</div>

<div id="panel" style="display:none;">
  <h2>Panel Privado</h2>
  <button onclick="cerrarSesion()">Cerrar sesi贸n</button>
  <p id="userInfo"></p>
  
  <hr>

  <h3>Nueva Estrategia</h3>
  <input type="text" id="titulo" placeholder="T铆tulo">
  <br><br>
  <textarea id="descripcion" placeholder="Descripci贸n"></textarea>
  <br><br>
  <button id="btnGuardar" class="btn-principal" onclick="guardarEstrategia()">Guardar</button>

  <hr>

  <h3>Mis Estrategias</h3>
  <ul id="listaEstrategias"></ul>
</div>

<script>
  const { createClient } = supabase;

  const client = createClient(
    "https://ynddzitxwddgmxfhdmru.supabase.co",
    "sb_publishable_1RLUVi5PCkOklX5Y3HOoIw_gMmb_use"
  );

  async function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const { error } = await client.auth.signInWithPassword({
      email,
      password
    });

    if (error) {
      alert(error.message);
      return;
    }

    loadUser();
  }

  async function loadUser() {
    const { data: { user } } = await client.auth.getUser();
    if (!user) return;

    document.getElementById("login").style.display = "none";
    document.getElementById("panel").style.display = "block";
    document.getElementById("userInfo").innerText = "Correo: " + user.email;

    cargarEstrategias();
  }

  async function logout() {
    await client.auth.signOut();
    location.reload();
  }

  async function guardarEstrategia() {

  const { data: { user } } = await client.auth.getUser();
  if (!user) return;

  const titulo = document.getElementById("titulo").value;
  const descripcion = document.getElementById("descripcion").value;

  const btnGuardar = document.getElementById("btnGuardar");
  const idEditando = btnGuardar.getAttribute("data-editando");

  //  SI ESTAMOS EDITANDO
  if (idEditando) {
    const { error } = await client
      .from("estrategias")
      .update({ titulo, descripcion })
      .eq("id", idEditando);

    if (error) {
      alert(error.message);
      return;
    }

    btnGuardar.removeAttribute("data-editando");
  } 
  //  SI ES NUEVA ESTRATEGIA
    document.getElementById("btnGuardar").removeAttribute("data-editando");
document.getElementById("btnGuardar").textContent = "Guardar";
  else {
    const { error } = await client.from("estrategias").insert([
      {
        user_id: user.id,
        titulo,
        descripcion
      }
    ]);

    if (error) {
      alert(error.message);
      return;
    }
  }

  document.getElementById("titulo").value = "";
  document.getElementById("descripcion").value = "";

  cargarEstrategias();
  }


async function eliminarEstrategia(id) {
  const confirmacion = confirm("驴Eliminar esta estrategia?");
  if (!confirmacion) return;

  const { error } = await client
    .from("estrategias")
    .delete()
    .eq("id", id);

  if (error) {
    alert(error.message);
    return;
  }

  cargarEstrategias();
}
async function cerrarSesion() {
  await client.auth.signOut();
  location.reload();
}

async function cargarEstrategias() {
  const { data, error } = await client
    .from("estrategias")
    .select("*")
    .order("created_at", { ascending: false });

  if (error) {
    console.log(error);
    return;
  }

  const lista = document.getElementById("listaEstrategias");
  lista.innerHTML = "";

  data.forEach(item => {
    const li = document.createElement("li");

    li.innerHTML = `
  <div class="contenido-estrategia">
    <strong>${item.titulo}</strong><br>
    ${item.descripcion}
  </div>

  <div class="acciones-estrategia">
    <button class="btn-secundario btn-editar" data-id="${item.id}">Editar</button>
<button class="btn-secundario btn-eliminar" data-id="${item.id}">Eliminar</button>
  </div>
`;

    lista.appendChild(li);
  });

  document.querySelectorAll(".btn-eliminar").forEach(boton => {
    boton.addEventListener("click", function () {
      const id = this.getAttribute("data-id");
      eliminarEstrategia(id);
    });
  });
  document.querySelectorAll(".btn-editar").forEach(boton => {
  boton.addEventListener("click", function () {
    const id = this.getAttribute("data-id");

    const estrategia = data.find(e => e.id === id);

    document.getElementById("titulo").value = estrategia.titulo;
    document.getElementById("descripcion").value = estrategia.descripcion;

    document.getElementById("btnGuardar").setAttribute("data-editando", id);
    document.getElementById("btnGuardar").textContent = "Actualizar";
  });
});
  
}

loadUser();
  </script>

</body>
</html>
